# CODE DUMP - 2025-10-28 17:47:28
# Project: mini ChatGpt
# Generated by copy_code_to_txt.py

================================================================================

--- FILE: all_code.txt ---
# Path: C:\vs code projects\mini ChatGpt\all_code.txt
# Size: 0 bytes



--------------------------------------------------------------------------------

--- FILE: front\package.json ---
# Path: C:\vs code projects\mini ChatGpt\front\package.json
# Size: 1203 bytes

{
  "name": "front",
  "version": "0.1.0",
  "private": true,
  "dependencies": {
    "@emotion/react": "^11.14.0",
    "@emotion/styled": "^11.14.1",
    "@mui/icons-material": "^7.3.4",
    "@mui/material": "^7.3.4",
    "@reduxjs/toolkit": "^2.9.2",
    "@testing-library/dom": "^10.4.1",
    "@testing-library/jest-dom": "^6.9.1",
    "@testing-library/react": "^16.3.0",
    "@testing-library/user-event": "^13.5.0",
    "@types/jest": "^27.5.2",
    "@types/node": "^16.18.126",
    "@types/react": "^19.2.2",
    "@types/react-dom": "^19.2.2",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-redux": "^9.2.0",
    "react-scripts": "5.0.1",
    "typescript": "^4.9.5",
    "web-vitals": "^2.1.4"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
  "eslintConfig": {
    "extends": [
      "react-app",
      "react-app/jest"
    ]
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  }
}


--------------------------------------------------------------------------------

--- FILE: front\README.md ---
# Path: C:\vs code projects\mini ChatGpt\front\README.md
# Size: 2117 bytes

# Getting Started with Create React App

This project was bootstrapped with [Create React App](https://github.com/facebook/create-react-app).

## Available Scripts

In the project directory, you can run:

### `npm start`

Runs the app in the development mode.\
Open [http://localhost:3000](http://localhost:3000) to view it in the browser.

The page will reload if you make edits.\
You will also see any lint errors in the console.

### `npm test`

Launches the test runner in the interactive watch mode.\
See the section about [running tests](https://facebook.github.io/create-react-app/docs/running-tests) for more information.

### `npm run build`

Builds the app for production to the `build` folder.\
It correctly bundles React in production mode and optimizes the build for the best performance.

The build is minified and the filenames include the hashes.\
Your app is ready to be deployed!

See the section about [deployment](https://facebook.github.io/create-react-app/docs/deployment) for more information.

### `npm run eject`

**Note: this is a one-way operation. Once you `eject`, you can’t go back!**

If you aren’t satisfied with the build tool and configuration choices, you can `eject` at any time. This command will remove the single build dependency from your project.

Instead, it will copy all the configuration files and the transitive dependencies (webpack, Babel, ESLint, etc) right into your project so you have full control over them. All of the commands except `eject` will still work, but they will point to the copied scripts so you can tweak them. At this point you’re on your own.

You don’t have to ever use `eject`. The curated feature set is suitable for small and middle deployments, and you shouldn’t feel obligated to use this feature. However we understand that this tool wouldn’t be useful if you couldn’t customize it when you are ready for it.

## Learn More

You can learn more in the [Create React App documentation](https://facebook.github.io/create-react-app/docs/getting-started).

To learn React, check out the [React documentation](https://reactjs.org/).


--------------------------------------------------------------------------------

--- FILE: front\tsconfig.json ---
# Path: C:\vs code projects\mini ChatGpt\front\tsconfig.json
# Size: 682 bytes

{
  "compilerOptions": {
    "target": "es5",
    "lib": [
      "dom",
      "dom.iterable",
      "esnext"
    ],
    "allowJs": true,
    "skipLibCheck": true,
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "noFallthroughCasesInSwitch": true,
    "module": "esnext",
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "baseUrl": "src",
    "paths": {
      "@/*": ["*"]
    }
  },
  "include": [
    "src"
  ],
  "exclude": [
    "node_modules",
    "build"
  ]
}

--------------------------------------------------------------------------------

--- FILE: front\public\index.html ---
# Path: C:\vs code projects\mini ChatGpt\front\public\index.html
# Size: 1721 bytes

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>React App</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
  </body>
</html>


--------------------------------------------------------------------------------

--- FILE: front\public\manifest.json ---
# Path: C:\vs code projects\mini ChatGpt\front\public\manifest.json
# Size: 492 bytes

{
  "short_name": "React App",
  "name": "Create React App Sample",
  "icons": [
    {
      "src": "favicon.ico",
      "sizes": "64x64 32x32 24x24 16x16",
      "type": "image/x-icon"
    },
    {
      "src": "logo192.png",
      "type": "image/png",
      "sizes": "192x192"
    },
    {
      "src": "logo512.png",
      "type": "image/png",
      "sizes": "512x512"
    }
  ],
  "start_url": ".",
  "display": "standalone",
  "theme_color": "#000000",
  "background_color": "#ffffff"
}


--------------------------------------------------------------------------------

--- FILE: front\public\robots.txt ---
# Path: C:\vs code projects\mini ChatGpt\front\public\robots.txt
# Size: 67 bytes

# https://www.robotstxt.org/robotstxt.html
User-agent: *
Disallow:


--------------------------------------------------------------------------------

--- FILE: front\src\App.css ---
# Path: C:\vs code projects\mini ChatGpt\front\src\App.css
# Size: 564 bytes

.App {
  text-align: center;
}

.App-logo {
  height: 40vmin;
  pointer-events: none;
}

@media (prefers-reduced-motion: no-preference) {
  .App-logo {
    animation: App-logo-spin infinite 20s linear;
  }
}

.App-header {
  background-color: #282c34;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-size: calc(10px + 2vmin);
  color: white;
}

.App-link {
  color: #61dafb;
}

@keyframes App-logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}


--------------------------------------------------------------------------------

--- FILE: front\src\App.test.tsx ---
# Path: C:\vs code projects\mini ChatGpt\front\src\App.test.tsx
# Size: 273 bytes

import React from 'react';
import { render, screen } from '@testing-library/react';
import App from './App';

test('renders learn react link', () => {
  render(<App />);
  const linkElement = screen.getByText(/learn react/i);
  expect(linkElement).toBeInTheDocument();
});


--------------------------------------------------------------------------------

--- FILE: front\src\App.tsx ---
# Path: C:\vs code projects\mini ChatGpt\front\src\App.tsx
# Size: 939 bytes

import { Container, CssBaseline, AppBar, Toolbar, Typography, Box } from '@mui/material';
import ConversationList from './components/ConversationList';
import ChatWindow from './components/ChatWindow';
import { ThemeProvider } from '@mui/material/styles';
import theme from './theme';
import { useState } from 'react';

function App() {
  const [selectedId, setSelectedId] = useState<string | null>(null);

  return (
    <ThemeProvider theme={theme}>
      <CssBaseline />
      <AppBar position="static">
        <Toolbar>
          <Typography variant="h6">Mini ChatGPT</Typography>
        </Toolbar>
      </AppBar>

      <Container maxWidth={false} disableGutters sx={{ display: 'flex', height: 'calc(100vh - 64px)' }}>
        <ConversationList onSelect={setSelectedId} />
        <Box flex={1}>
          <ChatWindow conversationId={selectedId} />
        </Box>
      </Container>
    </ThemeProvider>
  );
}

export default App;

--------------------------------------------------------------------------------

--- FILE: front\src\index.css ---
# Path: C:\vs code projects\mini ChatGpt\front\src\index.css
# Size: 366 bytes

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

code {
  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',
    monospace;
}


--------------------------------------------------------------------------------

--- FILE: front\src\index.tsx ---
# Path: C:\vs code projects\mini ChatGpt\front\src\index.tsx
# Size: 370 bytes

import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';
import { Provider } from 'react-redux';
import { store } from './store';

const root = ReactDOM.createRoot(
  document.getElementById('root') as HTMLElement
);
root.render(
  <React.StrictMode>
    <Provider store={store}>
      <App />
    </Provider>
  </React.StrictMode>
);

--------------------------------------------------------------------------------

--- FILE: front\src\react-app-env.d.ts ---
# Path: C:\vs code projects\mini ChatGpt\front\src\react-app-env.d.ts
# Size: 41 bytes

/// <reference types="react-scripts" />


--------------------------------------------------------------------------------

--- FILE: front\src\reportWebVitals.ts ---
# Path: C:\vs code projects\mini ChatGpt\front\src\reportWebVitals.ts
# Size: 425 bytes

import { ReportHandler } from 'web-vitals';

const reportWebVitals = (onPerfEntry?: ReportHandler) => {
  if (onPerfEntry && onPerfEntry instanceof Function) {
    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {
      getCLS(onPerfEntry);
      getFID(onPerfEntry);
      getFCP(onPerfEntry);
      getLCP(onPerfEntry);
      getTTFB(onPerfEntry);
    });
  }
};

export default reportWebVitals;


--------------------------------------------------------------------------------

--- FILE: front\src\setupTests.ts ---
# Path: C:\vs code projects\mini ChatGpt\front\src\setupTests.ts
# Size: 241 bytes

// jest-dom adds custom jest matchers for asserting on DOM nodes.
// allows you to do things like:
// expect(element).toHaveTextContent(/react/i)
// learn more: https://github.com/testing-library/jest-dom
import '@testing-library/jest-dom';


--------------------------------------------------------------------------------

--- FILE: front\src\theme.ts ---
# Path: C:\vs code projects\mini ChatGpt\front\src\theme.ts
# Size: 176 bytes

import { createTheme } from '@mui/material/styles';

export default createTheme({
  palette: {
    mode: 'light',
    primary: {
      main: '#1976i2',
    },
  },
});

--------------------------------------------------------------------------------

--- FILE: front\src\components\ChatWindow.tsx ---
# Path: C:\vs code projects\mini ChatGpt\front\src\components\ChatWindow.tsx
# Size: 2973 bytes

import { Box, CircularProgress, Button, Stack, Typography } from '@mui/material';
import { useGetConversationQuery, api } from '../store/api';
import { useAppDispatch } from '../store/hooks'; // We'll add this
import MessageBubble from './MessageBubble';
import MessageInput from './MessageInput';
import { useEffect, useRef, useState } from 'react';
import type { Message } from '../types';

interface Props {
  conversationId: string | null;
}

export default function ChatWindow({ conversationId }: Props) {
  const dispatch = useAppDispatch();
  const [olderMessages, setOlderMessages] = useState<Message[]>([]);
  const [isLoadingOlder, setIsLoadingOlder] = useState(false);

  const {
    data: convo,
    isLoading,
    isFetching,
  } = useGetConversationQuery(
    { id: conversationId!, limit: 20 },
    { skip: !conversationId, refetchOnMountOrArgChange: true }
  );

  const scrollRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    scrollRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [convo?.messages, olderMessages]);

  const handleLoadMore = async () => {
    if (!convo?.pageInfo.prevCursor || !conversationId || isLoadingOlder) return;

    setIsLoadingOlder(true);
    try {
      const result = await dispatch(
        api.endpoints.getConversation.initiate({
          id: conversationId,
          cursor: convo.pageInfo.prevCursor,
          limit: 20,
        })
      ).unwrap();

      // Prepend older messages
      setOlderMessages((prev) => [...result.messages, ...prev]);
    } catch (err) {
      console.error('Failed to load older messages', err);
    } finally {
      setIsLoadingOlder(false);
    }
  };

  if (!conversationId) {
    return (
      <Box flex={1} display="flex" alignItems="center" justifyContent="center">
        <Typography color="text.secondary">Select or create a conversation</Typography>
      </Box>
    );
  }

  if (isLoading) {
    return (
      <Box flex={1} display="flex" alignItems="center" justifyContent="center">
        <CircularProgress />
      </Box>
    );
  }

  const allMessages = [...olderMessages, ...(convo?.messages || [])];

  return (
    <Box display="flex" flexDirection="column" height="100%">
      {/* Load Older Button */}
      {convo?.pageInfo.prevCursor && (
        <Stack alignItems="center" py={1}>
          <Button
            size="small"
            onClick={handleLoadMore}
            disabled={isLoadingOlder || isFetching}
          >
            {isLoadingOlder ? 'Loading...' : 'Load older messages'}
          </Button>
        </Stack>
      )}

      {/* Messages */}
      <Box flex={1} overflow="auto" p={2}>
        {allMessages.map((m) => (
          <MessageBubble key={m.id} msg={m} />
        ))}
        <div ref={scrollRef} />
      </Box>

      {/* Input */}
      <MessageInput conversationId={conversationId} />
    </Box>
  );
}

--------------------------------------------------------------------------------

--- FILE: front\src\components\ConversationList.tsx ---
# Path: C:\vs code projects\mini ChatGpt\front\src\components\ConversationList.tsx
# Size: 4558 bytes

import {
  List, ListItem, ListItemText, IconButton, Drawer, Box, Typography, Button,
  useMediaQuery, useTheme, Snackbar, Alert, ListItemButton
} from '@mui/material';
import DeleteIcon from '@mui/icons-material/Delete';
import AddIcon from '@mui/icons-material/Add';
import MenuIcon from '@mui/icons-material/Menu';
import {
  useGetConversationsQuery,
  useCreateConversationMutation,
  useDeleteConversationMutation,
  api,
} from '../store/api';
import { useState, useEffect } from 'react';
import { useDispatch } from 'react-redux';
import type { AppDispatch } from '../store';

interface Props {
  onSelect: (id: string) => void;
}

export default function ConversationList({ onSelect }: Props) {
  const theme = useTheme();
  const isMobile = useMediaQuery(theme.breakpoints.down('md'));
  const [mobileOpen, setMobileOpen] = useState(false);
  const [undoId, setUndoId] = useState<string | null>(null);
  const [undoTimer, setUndoTimer] = useState<NodeJS.Timeout | null>(null);

  const dispatch = useDispatch<AppDispatch>();
  const { data: conversations = [], isLoading, refetch } = useGetConversationsQuery();
  const [create] = useCreateConversationMutation();
  const [deleteConvo] = useDeleteConversationMutation();

  const handleDelete = (id: string) => {
    dispatch(
      api.util.updateQueryData('getConversations', undefined, (draft) =>
        draft.filter((c) => c.id !== id)
      )
    );

    const timer = setTimeout(() => {
      deleteConvo(id);
      setUndoId(null);
    }, 5000);

    setUndoId(id);
    setUndoTimer(timer);
  };

  const handleUndo = () => {
    if (undoTimer) clearTimeout(undoTimer);
    setUndoId(null);
    refetch();
  };

  useEffect(() => {
    return () => {
      if (undoTimer) clearTimeout(undoTimer);
    };
  }, [undoTimer]);

  return (
    <>
      {/* Desktop Sidebar */}
      {!isMobile && (
        <Box sx={{ width: 300, borderRight: 1, borderColor: 'divider', overflow: 'auto' }}>
          <InnerList />
        </Box>
      )}

      {/* Mobile Drawer */}
      {isMobile && (
        <>
          <IconButton onClick={() => setMobileOpen(true)} sx={{ ml: 1, mt: 1 }}>
            <MenuIcon />
          </IconButton>
          <Drawer open={mobileOpen} onClose={() => setMobileOpen(false)}>
            <Box sx={{ width: 280 }}>
              <InnerList onClose={() => setMobileOpen(false)} />
            </Box>
          </Drawer>
        </>
      )}

      <Snackbar
        open={!!undoId}
        anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}
        autoHideDuration={null}
      >
        <Alert
          severity="info"
          action={
            <Button color="inherit" size="small" onClick={handleUndo}>
              UNDO
            </Button>
          }
        >
          Conversation deleted
        </Alert>
      </Snackbar>
    </>
  );

  function InnerList({ onClose }: { onClose?: () => void }) {
    return (
      <>
        <Box p={2} display="flex" justifyContent="space-between">
          <Typography variant="h6">Chats</Typography>
          <Button
            startIcon={<AddIcon />}
            onClick={async () => {
              const res = await create().unwrap();
              onSelect(res.id);
              onClose?.();
            }}
          >
            New
          </Button>
        </Box>

        {isLoading ? (
          <Typography p={2}>Loading...</Typography>
        ) : (
          <List>
            {conversations.map((c) => (
              <ListItem key={c.id} disablePadding>
                <ListItemButton
                  selected={false}
                  onClick={() => {
                    onSelect(c.id);
                    onClose?.();
                  }}
                  sx={{ pl: 2, pr: 1 }}
                >
                  <ListItemText
                    primary={c.title}
                    secondary={c.lastMessageAt ? new Date(c.lastMessageAt).toLocaleString() : 'No messages'}
                  />
                  <IconButton
                    edge="end"
                    onClick={(e) => {
                      e.stopPropagation();
                      handleDelete(c.id);
                    }}
                  >
                    <DeleteIcon />
                  </IconButton>
                </ListItemButton>
              </ListItem>
            ))}
          </List>
        )}
      </>
    );
  }
}

--------------------------------------------------------------------------------

--- FILE: front\src\components\MessageBubble.tsx ---
# Path: C:\vs code projects\mini ChatGpt\front\src\components\MessageBubble.tsx
# Size: 691 bytes

import { Paper, Typography, Box } from '@mui/material';
import { Message } from '../types';

export default function MessageBubble({ msg }: { msg: Message }) {
  const isUser = msg.role === 'user';
  return (
    <Box sx={{ display: 'flex', justifyContent: isUser ? 'flex-end' : 'flex-start', mb: 1.5 }}>
      <Paper
        sx={{
          maxWidth: '75%',
          p: 1.5,
          bgcolor: isUser ? 'primary.main' : 'grey.100',
          color: isUser ? 'white' : 'text.primary',
          borderRadius: 2,
        }}
      >
        <Typography variant="body1" whiteSpace="pre-wrap">
          {msg.content}
        </Typography>
      </Paper>
    </Box>
  );
}

--------------------------------------------------------------------------------

--- FILE: front\src\components\MessageInput.tsx ---
# Path: C:\vs code projects\mini ChatGpt\front\src\components\MessageInput.tsx
# Size: 2052 bytes

import { TextField, IconButton, Box, CircularProgress } from '@mui/material';
import SendIcon from '@mui/icons-material/Send';
import CancelIcon from '@mui/icons-material/Cancel';
import { useSendMessageMutation } from '../store/api';
import { useState, useRef } from 'react';

interface Props {
  conversationId: string;
}

export default function MessageInput({ conversationId }: Props) {
  const [send, { isLoading }] = useSendMessageMutation();
  const [value, setValue] = useState('');
  const controllerRef = useRef<AbortController | null>(null);

  const handleSend = async () => {
    if (!value.trim() || isLoading) return;

    const controller = new AbortController();
    controllerRef.current = controller;

    try {
      await send({
        conversationId,
        content: value.trim(),
      }).unwrap();
      setValue('');
    } catch (err: any) {
      if (err.name === 'AbortError') {
        console.log('Send cancelled');
      }
    } finally {
      controllerRef.current = null;
    }
  };

  const handleCancel = () => {
    controllerRef.current?.abort();
  };

  return (
    <Box p={2} borderTop={1} borderColor="divider">
      <TextField
        fullWidth
        multiline
        maxRows={5}
        value={value}
        onChange={(e) => setValue(e.target.value)}
        onKeyDown={(e) => {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            handleSend();
          }
        }}
        disabled={isLoading}
        placeholder="Type a message..."
        InputProps={{
          endAdornment: isLoading ? (
            <>
              <CircularProgress size={20} sx={{ mr: 1 }} />
              <IconButton onClick={handleCancel}>
                <CancelIcon />
              </IconButton>
            </>
          ) : (
            <IconButton onClick={handleSend} disabled={!value.trim()}>
              <SendIcon />
            </IconButton>
          ),
        }}
      />
    </Box>
  );
}

--------------------------------------------------------------------------------

--- FILE: front\src\components\UndoToast.tsx ---
# Path: C:\vs code projects\mini ChatGpt\front\src\components\UndoToast.tsx
# Size: 0 bytes



--------------------------------------------------------------------------------

--- FILE: front\src\store\api.ts ---
# Path: C:\vs code projects\mini ChatGpt\front\src\store\api.ts
# Size: 3416 bytes

import { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react';
import type {
  Conversation,
  ConversationWithMessages,
  SendResponse,
} from '../types';

export const api = createApi({
  baseQuery: fetchBaseQuery({
    baseUrl: '/api',
    timeout: 12000,
  }),
  tagTypes: ['Conversation'],
  endpoints: (builder) => ({
    getConversations: builder.query<Conversation[], void>({
      query: () => '/conversations',
      providesTags: (result) =>
        result
          ? [
              ...result.map(({ id }) => ({ type: 'Conversation' as const, id })),
              { type: 'Conversation', id: 'LIST' },
            ]
          : [{ type: 'Conversation', id: 'LIST' }],
    }),

    createConversation: builder.mutation<Conversation, void>({
      query: () => ({
        url: '/conversations',
        method: 'POST',
      }),
      invalidatesTags: [{ type: 'Conversation', id: 'LIST' }],
    }),

    getConversation: builder.query<
      ConversationWithMessages,
      { id: string; cursor?: string; limit?: number }
    >({
      query: ({ id, cursor, limit = 20 }) => ({
        url: `/conversations/${id}`,
        params: { messagesCursor: cursor, limit },
      }),
      providesTags: (result, error, { id }) => [{ type: 'Conversation', id }],
    }),

    sendMessage: builder.mutation<
      SendResponse,
      { conversationId: string; content: string }
    >({
      query: ({ conversationId, content }) => ({
        url: `/conversations/${conversationId}/messages`,
        method: 'POST',
        body: { content },
      }),
      invalidatesTags: (result, error, { conversationId }) => [
        { type: 'Conversation', id: conversationId },
        { type: 'Conversation', id: 'LIST' },
      ],
      async onQueryStarted(
        { conversationId, content },
        { dispatch, queryFulfilled }
      ) {
        const patchResult = dispatch(
          api.util.updateQueryData(
            'getConversation',
            { id: conversationId },
            (draft) => {
              const tempId = `temp-${Date.now()}`;
              draft.messages.push({
                id: tempId,
                role: 'user',
                content,
                createdAt: new Date().toISOString(),
              });
            }
          )
        );
        try {
          const { data } = await queryFulfilled;
          dispatch(
            api.util.updateQueryData(
              'getConversation',
              { id: conversationId },
              (draft) => {
                draft.messages = draft.messages.filter((m) => !m.id.startsWith('temp-'));
                draft.messages.push(data.message, data.reply);
              }
            )
          );
        } catch {
          patchResult.undo();
        }
      },
    }),

    deleteConversation: builder.mutation<void, string>({
      query: (id) => ({
        url: `/conversations/${id}`,
        method: 'DELETE',
      }),
      invalidatesTags: (result, error, id) => [
        { type: 'Conversation', id },
        { type: 'Conversation', id: 'LIST' },
      ],
    }),
  }),
});

// Export only hooks and api
export const {
  useGetConversationsQuery,
  useCreateConversationMutation,
  useGetConversationQuery,
  useSendMessageMutation,
  useDeleteConversationMutation,
} = api;

--------------------------------------------------------------------------------

--- FILE: front\src\store\hooks.ts ---
# Path: C:\vs code projects\mini ChatGpt\front\src\store\hooks.ts
# Size: 327 bytes

import { useDispatch, useSelector, TypedUseSelectorHook } from 'react-redux';
import type { RootState, AppDispatch } from './index';

// Typed versions of useDispatch and useSelector
export const useAppDispatch = () => useDispatch<AppDispatch>();
export const useAppSelector: TypedUseSelectorHook<RootState> = useSelector;

--------------------------------------------------------------------------------

--- FILE: front\src\store\index.ts ---
# Path: C:\vs code projects\mini ChatGpt\front\src\store\index.ts
# Size: 879 bytes

import { configureStore } from '@reduxjs/toolkit';
import { api } from './api';

// -------------------------------------------------
// 1. Create the store (only one declaration!)
export const store = configureStore({
  reducer: {
    [api.reducerPath]: api.reducer,
  },
  middleware: (getDefaultMiddleware) =>
    getDefaultMiddleware({
      serializableCheck: false,
    }).concat(api.middleware),
});

// -------------------------------------------------
// 2. Type exports (required for hooks)
export type RootState = ReturnType<typeof store.getState>;
export type AppDispatch = typeof store.dispatch;

// -------------------------------------------------
// 3. **DO NOT re-export `store` here** – it is already exported above.
//     Remove any line like: `export { store };` or `import store`
// -------------------------------------------------

--------------------------------------------------------------------------------

--- FILE: front\src\types\index.ts ---
# Path: C:\vs code projects\mini ChatGpt\front\src\types\index.ts
# Size: 573 bytes

export type Role = 'user' | 'assistant';

export interface Message {
  id: string;
  role: Role;
  content: string;
  createdAt: string;
}

export interface Conversation {
  id: string;
  title: string;
  createdAt: string;
  lastMessageAt: string | null;
}

export interface PageInfo {
  nextCursor: string | null;
  prevCursor: string | null;
}

export interface ConversationWithMessages {
  id: string;
  title: string;
  messages: Message[];
  pageInfo: PageInfo;
}

export interface SendResponse {
  message: Message;
  reply: Message;
}

--------------------------------------------------------------------------------


# TOTAL FILES COPIED: 25
# Finished at: 2025-10-28 17:47:32
